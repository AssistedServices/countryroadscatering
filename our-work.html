<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Our Work | Country Roads Catering</title>
  <meta name="description" content="A curated selection of weddings and events catered by Country Roads Catering.">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --green:#2C3E36; --cream:#F7F3EC; --charcoal:#1A1A1A;
      --gold:#C7A86B; --sage:#B7C9A9; --container:1200px;
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--cream);color:var(--charcoal)}
    body{font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.6}
    img{max-width:100%;display:block}
    a{color:inherit;text-decoration:none}
    .container{max-width:var(--container);margin-inline:auto;padding:clamp(16px,2vw,24px)}
    h1,h2,h3{font-family:"Playfair Display",serif;line-height:1.2;color:var(--green);margin:0 0 .4em}
    .subtitle{color:#3b4a44;max-width:60ch}

    /* Header (reused) */
    header{position:sticky;top:0;z-index:100;background:rgba(247,243,236,.92);backdrop-filter:saturate(150%) blur(8px);border-bottom:1px solid rgba(0,0,0,.06)}
    .nav{max-width:var(--container);margin-inline:auto;padding-block:10px;display:flex;align-items:center;justify-content:space-between;gap:16px}
    .nav__brand img{height:64px;width:auto}
    .nav__menu{display:flex;gap:1rem;flex-wrap:wrap}
    .nav__menu a{padding:.6rem .8rem;border-radius:999px}
    .nav__menu a:hover{background:rgba(44,62,54,.08)}

    main{padding:clamp(28px,4vw,48px) 0}

    /* Filter bar */
    .filters{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 18px}
    .chip{
      display:inline-flex;align-items:center;
      padding:.4rem .75rem;border-radius:999px;border:1px solid #cfd7d2;background:#fff;cursor:pointer;font-weight:600;font-size:.9rem;
    }
    .chip.active{background:var(--sage);border-color:var(--sage)}

    /* Gallery cards + captions */
    .gallery{display:grid;gap:14px}
    @media (min-width:600px){.gallery{grid-template-columns: repeat(2, 1fr)}}
    @media (min-width:900px){.gallery{grid-template-columns: repeat(3, 1fr)}}
    .card{border-radius:14px;overflow:hidden;box-shadow:var(--shadow);background:#fff;display:flex;flex-direction:column}
    .card img{width:100%;height:100%;object-fit:cover;aspect-ratio:16/10}
    .cap{padding:.6rem .8rem;font-size:.95rem;color:#2b2b2b;border-top:1px solid #eee}

    .empty{padding:24px;border:1px dashed #c7c7c7;border-radius:12px;background:#fff;text-align:center;color:#555}

    /* Lightbox */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;place-items:center;z-index:1000}
    .lightbox[aria-hidden="false"]{display:grid}
    .lightbox__img{max-width:min(92vw,1400px);max-height:74vh;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.4);object-fit:contain;background:#000}
    .lightbox__caption{color:#fff;max-width:min(92vw,1400px);margin-top:12px;text-align:center}
    .lightbox__close,.lightbox__prev,.lightbox__next{
      position:absolute;top:16px;background:rgba(0,0,0,.5);color:#fff;border:none;border-radius:999px;
      width:44px;height:44px;font-size:22px;cursor:pointer;display:grid;place-items:center
    }
    .lightbox__close{right:16px}
    .lightbox__prev{left:16px;top:50%;transform:translateY(-50%)}
    .lightbox__next{right:16px;top:50%;transform:translateY(-50%)}

    footer{background:var(--green);color:#fff}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="nav">
      <a class="nav__brand" href="index.html#top">
        <img src="/images/Main Logo Transparant.png" alt="Country Roads Catering logo">
      </a>
      <nav class="nav__menu" aria-label="Primary">
        <a href="index.html#services">Services</a>
        <a href="index.html#menu">Menu</a>
        <a href="our-work.html" aria-current="page">Our Work</a>
        <a href="index.html#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>Our Work</h1>
    <p class="subtitle">A look at recent weddings and events we’ve catered across the South Coast.</p>

    <!-- Filters -->
    <div id="filters" class="filters" aria-label="Filter portfolio"></div>

    <!-- Gallery -->
    <div id="gallery" class="gallery" aria-live="polite"></div>
    <div id="empty" class="empty" hidden>No items match your filters. Clear some tags to see more.</div>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-modal="true">
    <button class="lightbox__close" title="Close" aria-label="Close">×</button>
    <button class="lightbox__prev" title="Previous" aria-label="Previous">‹</button>
    <img class="lightbox__img" id="lightboxImg" alt="">
    <div id="lightboxCap" class="lightbox__caption"></div>
    <button class="lightbox__next" title="Next" aria-label="Next">›</button>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container" style="display:flex;justify-content:space-between;gap:24px;flex-wrap:wrap;align-items:flex-start">
      <div>
        <p style="margin:0">© <span id="y"></span> Country Roads Catering • South Coast, UK</p>
        <p style="margin:0"><a href="https://www.assist.wtf" target="_blank" rel="noopener noreferrer" style="color:#fff">Designed, Built, Deployed &amp; Automated by Assist.wtf</a></p>
      </div>
      <p style="margin:0"><a href="#" style="color:#fff">Privacy</a> · <a href="#" style="color:#fff">Accessibility</a></p>
    </div>
  </footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // ---- Portfolio data
    const ITEMS = [
      {src:"/images/portfolio-1.jpg",  cap:"Evening buffet table",               tags:["Buffet","Evening"]},
      {src:"/images/portfolio-2.jpg",  cap:"Succulent hog roast",                tags:["BBQ","Mains"]},
      {src:"/images/portfolio-3.jpg",  cap:"Ham & pear canapés",                 tags:["Canapés","Starters"]},
      {src:"/images/portfolio-4.jpg",  cap:"Seared fish main",                   tags:["Plated","Mains","Weddings"]},
      {src:"/images/portfolio-5.jpg",  cap:"Evening buffet selection",           tags:["Buffet","Weddings"]},
      {src:"/images/portfolio-6.jpg",  cap:"BBQ platter",                        tags:["BBQ","Sharing"]},
      {src:"/images/portfolio-7.jpg",  cap:"Grazing stack",                      tags:["Grazing","Sharing","Weddings"]},
      {src:"/images/portfolio-8.jpg",  cap:"Indoor wedding dinner",              tags:["Weddings"]},
      {src:"/images/portfolio-9.jpg",  cap:"Wine and canapés",                   tags:["Canapés"]},
      {src:"/images/portfolio-10.jpg", cap:"Vegetarian platter",                 tags:["Sharing","Buffet"]},
      {src:"/images/portfolio-11.jpg", cap:"Chocolate brownie desserts",         tags:["Desserts","Weddings"]},
      {src:"/images/portfolio-12.jpg", cap:"Sopley Tart desserts",               tags:["Desserts","Weddings"]},
      {src:"/images/portfolio-13.jpg", cap:"Chef setting up grazing table",      tags:["Grazing"]},
      {src:"/images/portfolio-14.jpg", cap:"Drinks package",                     tags:["Weddings"]}
    ];

    // util: get 'portfolio-12.jpg' from '/images/portfolio-12.jpg'
    const basename = (p) => p.split('/').pop();

    // Build tag list
    const TAGS = [...new Set(ITEMS.flatMap(i => i.tags))].sort((a,b)=>a.localeCompare(b));

    // SINGLE‑SELECT state
    let activeTag = null; // null = All

    const filtersEl = document.getElementById('filters');
    const galleryEl = document.getElementById('gallery');
    const emptyEl = document.getElementById('empty');

    // Chip component
    function chip(label, isActive, onClick){
      const c = document.createElement('button');
      c.type = 'button';
      c.className = 'chip' + (isActive ? ' active' : '');
      c.textContent = label;
      c.addEventListener('click', onClick);
      return c;
    }

    // Render filter chips (single‑select)
    function renderFilters(){
      filtersEl.innerHTML = '';
      filtersEl.appendChild(chip("All", activeTag === null, () => {
        activeTag = null; render();
      }));
      TAGS.forEach(tag => {
        const isActive = activeTag === tag;
        filtersEl.appendChild(chip(tag, isActive, () => {
          activeTag = isActive ? null : tag; // clicking active clears to All
          render();
        }));
      });
    }

    // Filtered list
    function getFiltered(){
      const rows = ITEMS.map((it,i)=>({i, ...it}));
      if (!activeTag) return rows;
      return rows.filter(row => row.tags.includes(activeTag));
    }

    let filtered = getFiltered();

    // Render gallery
    function render(){
      filtered = getFiltered();
      galleryEl.innerHTML = '';
      emptyEl.hidden = filtered.length !== 0;

      filtered.forEach((row, idx) => {
        const a = document.createElement('a');
        a.href = `/our-work/${basename(row.src)}`; // pretty path
        a.className = 'card';

        const img = document.createElement('img');
        img.src = row.src; img.loading = 'lazy'; img.alt = row.cap || 'Portfolio image';

        const cap = document.createElement('div');
        cap.className = 'cap';
        cap.textContent = row.cap || '';

        a.appendChild(img); a.appendChild(cap);
        galleryEl.appendChild(a);

        a.addEventListener('click', (e) => {
          e.preventDefault();
          openLightbox(idx); // idx within filtered set
          history.pushState({ img: row.src }, "", `/our-work/${basename(row.src)}`);
        });
      });
      // If a lightbox is open and the current image was filtered out, close it
      if (lb.getAttribute('aria-hidden') === 'false') {
        const slug = location.pathname.replace(/^\/our-work\/?/, '');
        if (slug && slug.includes('.')) {
          const stillVisible = filtered.some(r => basename(r.src) === slug);
          if (!stillVisible) closeLightbox();
        }
      }
    }

    // Lightbox (with caption), respecting current filters
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lightboxImg');
    const lbCap = document.getElementById('lightboxCap');
    const btnClose = lb.querySelector('.lightbox__close');
    const btnPrev = lb.querySelector('.lightbox__prev');
    const btnNext = lb.querySelector('.lightbox__next');
    let fidx = 0;

    function openLightbox(i){
      filtered = getFiltered();
      if (!filtered.length) return;
      fidx = (i + filtered.length) % filtered.length;
      const row = filtered[fidx];
      lbImg.src = row.src;
      lbImg.alt = row.cap || 'Portfolio image';
      lbCap.textContent = row.cap || '';
      lb.setAttribute('aria-hidden','false');
      document.documentElement.style.overflow = 'hidden';
    }
    function closeLightbox(){
      lb.setAttribute('aria-hidden','true');
      document.documentElement.style.overflow = '';
      if (location.pathname.startsWith('/our-work/')) {
        history.pushState({}, "", '/our-work');
      }
    }
    function next(){
      openLightbox(fidx+1);
      history.replaceState({img: filtered[fidx].src}, "", `/our-work/${basename(filtered[fidx].src)}`);
    }
    function prev(){
      openLightbox(fidx-1);
      history.replaceState({img: filtered[fidx].src}, "", `/our-work/${basename(filtered[fidx].src)}`);
    }

    btnClose.addEventListener('click', closeLightbox);
    btnNext.addEventListener('click', next);
    btnPrev.addEventListener('click', prev);
    lb.addEventListener('click', (e)=>{ if(e.target===lb) closeLightbox(); });

    // Back/forward buttons
    window.addEventListener('popstate', () => {
      const slug = location.pathname.replace(/^\/our-work\/?/, '');
      if (slug && slug.includes('.')) {
        const iInItems = ITEMS.findIndex(it => basename(it.src) === slug);
        if (iInItems >= 0) {
          const fIndex = getFiltered().findIndex(row => row.i === iInItems);
          if (fIndex >= 0) { openLightbox(fIndex); return; }
        }
      }
      closeLightbox();
    });

    // Boot
    renderFilters();
    render();

    // Deep‑link on initial load: /our-work/<filename>
    (function openFromPath(){
      const slug = location.pathname.replace(/^\/our-work\/?/, '');
      if (!slug || !slug.includes('.')) return;
      const iInItems = ITEMS.findIndex(it => basename(it.src) === slug);
      if (iInItems >= 0){
        const fIndex = getFiltered().findIndex(row => row.i === iInItems);
        if (fIndex >= 0) openLightbox(fIndex);
      }
    })();
  </script>
</body>
</html>
